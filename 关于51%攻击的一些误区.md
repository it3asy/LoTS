# 网上介绍区块链51%攻击文章的一些误区

// 2018/11/11

## 几个例子

看了一些网上关于解释区块链中“%51攻击”文章，特别是涉及到数值计算的文章，很多都有问题，容易误导人。举例来说：

1）比如简书上这篇[一分钟讲明白区块链数据不可篡改和51%攻击原理](https://www.jianshu.com/p/b644c60018cd)，文中：  

>第3章 什么是51%攻击
>
> 其实话说回来，如果微信群500人，其中有251人都统一行动，将聊天记录修改成了一个新的版本，然后站出来指责别的249个人的那个纪录是假的，因为本着以少数服从多数的原则，这249个人的聊天记录真的就会被屈打成招，被迫承认那251个人的记录才是真正的历史纪录。
>
> 这就是51%攻击。所以说，微信群的聊天记录不可篡改的前提条件是不会出现有一半以上的人统一协调起来篡改，如果会发生，那就无法保持不可篡改性。

显然，区块链常说的“51%攻击”不是这里描述的这种情况。

2）比如CSDN上的这篇[什么是比特币51%攻击](https://blog.csdn.net/pony_maggie/article/details/60579675)，文中：
>
> 假设Alice就是那个大boss，拥有网络51%的算力，他真的不愿意为这笔咖啡付钱(有钱人也可能很小气)，于是他开始攻击了。  
> ...  
> 从另一方面看，如果真有这样的51%攻击，建议是收款方等到全网的 6 个确认之后再交付商品。按照10分钟一个区块的速度，也只需一个小时就可以保证你的钱是否基本肯定收到。
> 
> 注意这里用的是基本肯定，不过等的时间越长这笔交易越安全是肯定的。
> 
> 原理其实也很简单。对于Alice来说，假设他要伪造的区块就是最后一个，他只需要计算一次成功就可以了，但是如果他要篡改交易的那个区块后面的区块有六个，他就要重新计算六个区块，难度大很多。

针对上面的内容有两个问题：  

1. 理论上，增加确认数只在攻击者算力小于50%的情况下有意义，文章已经假定攻击者算力51%了，那不管你等几个确认只要有足够时间他是一定会成功的，“基本肯定收到”不成立。

2. 等6个确认后不意味着攻击者要追赶6个区块，攻击者不是等你有6个确认后他才会开始攻击，甚至可能在他发出交易时就已经偷偷领先几个块了。


3）比如先知社区上这篇[区块链安全—详谈共识攻击（一）](https://xz.aliyun.com/t/3139)，原文很长又有图，不好引用，关键内容：
>
> 假设诈骗者掌握了全网1%的计算能力，那么他争取到记账权的概率就是1%，两次就是10的负4次方。那还是存在一定概率进行攻击的。  
> ...   
> 假设诈骗者掌握了全网1%的计算能力，那么他争取到记账权的概率就是1%，两次就是10的负4次方。那还是存在一定概率进行攻击的。  
> ...  
> 下面我们就算个数，倘若我掌握了全网的51%的算力，那么我成功记录六个区块的概率是多少呢？    
> ...  
> 成功概率 = 0.51 \* 0.51 \* 0.51 \* 0.51 \* 0.51 \* 0.51 ~= 0.018

`成功概率 = 0.51**6 ~= 0.018`，这不能用来表示攻击者成功的概率。假如攻击者当前落后6个块，他要追上来不需要连续6次抢到记账权，只需要在接下来的某个时间段争取到的记账权比诚实节点多6次就可以了。


## 小结

还有很多文章，不一一列举，总结起来主要有几个误区：

1）概念性偏差或不严谨，类似第一篇的例子；还有些文章把“51%攻击”和“双花”混为一谈、把“51%攻击”表述成可“伪造交易（或区块）”等等，我觉得是不合适的。

2）计算过程错误，类似第二三篇的例子；很多关于“51%攻击”涉及到数值和计算过程的文章都有问题，问题主要出现在两个地方：  

1. 把确认数视为领先数。若一笔交易得到N个确认，这不意味着眼下攻击者就要追赶N个块，领先数应该等于确认数减去攻击者可能的进展。（比特币白皮书的计算方式中把攻击者可能的进展看作一个泊松分布）  

2. 认为追赶是连续完成的。若攻击者当前落后N个块，这不意味着攻击者要连续挖到N个块完成追赶，而是从攻击时间点开始到攻击成功时间点期间，攻击者在攻击链挖出的块要比诚实节点在诚实链挖出的块多N个就行。

概念性偏差或不严谨这个我倒不是太关注的，只是恰好看到了顺便提一下。主要是想指出那涉及到数值和计算的文章，毕竟数值和计算是个严谨的东西。   


## 其它

现在对于“%51攻击”这个概念的使用也很有问题，同样叫“区块链%51攻击介绍”的两篇文章，它们可能是完全不一样主题内容。一篇可能讲的是一个攻击者掌握了%51（或说大于等于%50）算力的后果，“51%攻击”的划不来原理等；另一篇讲的是一个攻击者（算力在50%以下）怎么通过和诚实节点间的“挖矿竞赛”实现撤销已确认交易的过程。当然我们知道通过补充相关计算内容是可以把二者衔接起来的，但这些文章里往往是没有计算的内容。这时候第一种情况叫“51%攻击”是合理的，第二种情况就不合理了，因为内容和“%51”没什么关联，但它又确实阐述了一个普遍的攻击过程。“51%”代表一种特殊性，我觉得还要有一个普遍性的名字来描述这种攻击过程，就像除了有“三打白骨精”命名一个特定场景外还有“西游记”来命名整个师徒西天取经的故事。

很多地方把“%51攻击”和“双花”等同起来也是不合适的。一方面，只能说这种“挖矿竞赛”式的攻击能实现“双花”的目的，早期在电子货币中“double-spending”的概念是指一笔钱同时消费多次，区块链货币是默认没有这个问题的，这里说的实现“双花”是“消费-拿回-再消费”的过程；另一方面，攻击者算力达到50%时，他不止能“双花”，还能独享挖矿、阻止任意交易乃至摧毁区块链体系的运转。

关于“51%”这个关键数值的来历，如果攻击者落后数是已知的，那攻击成功的概率就是成了“赌徒破产”或“酒鬼徘徊”的概率模型。用个简单代码模拟这个过程。
  
    51%-attack.py
  
**网上关于“赌徒破产”或“酒鬼徘徊”模型的数学计算我觉得也不严谨（讨论方程`P(1)=p*P(1)^2+1-p=0`解的时候），得找时间去研究下这个问题。**

